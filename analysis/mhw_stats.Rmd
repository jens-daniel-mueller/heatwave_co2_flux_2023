---
title: "Marine Heatwave 2023"
author: "Jens Daniel MÃ¼ller"
date:  "`r format(Sys.time(), '%d %B, %Y')`"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

```{r parent, child = "/nfs/kryo/work/jenmueller/emlr_cant/utilities/setup.Rmd"}
# this chunk runs the code stored in setup.Rmd
# if required, please refer to instructions given here:
# https://jdblischak.github.io/workflowr/articles/wflow-07-common-code.html
```

```{r load_libraries_specific, include = FALSE}

```


# Load masks

```{r mask_and_map}

map <-
  read_rds("../data/map.rds")

key_biomes <-
  read_rds("../data/key_biomes.rds")

super_biomes <-
  read_rds("../data/super_biomes.rds")

super_biome_mask <-
  read_rds("../data/super_biome_mask.rds")

biome_mask <-
  read_rds("../data/biome_mask.rds")


```



# Read data

```{r read_data}

MHW_cat_pixel_2023 <- read_rds("../data/MHW_cat_pixel_2023.Rds")


MHW_cat_pixel_2023 <-
  MHW_cat_pixel_2023 %>%
  rename(time = t) %>%
  mutate(lon = if_else(lon < 20, lon + 360, lon))


MHW_cat_daily_2023 <- read_rds("../data/MHW_cat_daily_2023.Rds")


```

# Maps


```{r plot_mhw_map}

fillColCat <- c(
  "I Moderate" = "#ffc866",
  "II Strong" = "#ff6900",
  "III Severe" = "#9e0000",
  "IV Extreme" = "#2d0000"
  )


map +
  scale_fill_manual(values = fillColCat) +
  geom_tile(data =
              MHW_cat_pixel_2023, aes(lon, lat, fill = category))


map +
  geom_tile(data =
              MHW_cat_pixel_2023, aes(lon, lat, fill = intensity_sum)) +
  scale_fill_viridis_b(option = "magma",
                       breaks = c(seq(0, 1000, 200), Inf),
                       direction = -1)


```

